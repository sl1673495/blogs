{"componentChunkName":"component---src-templates-blog-post-js","path":"/549412665/","result":{"data":{"site":{"siteMetadata":{"title":"sshçš„åšå®¢","author":"ssh"}},"markdownRemark":{"id":"2c5a53f3-e4c6-5f27-9d3b-5a9eba605701","html":"<h2 id=\"å‰è¨€\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>å‰è¨€</h2>\n<p> å„ä½ä½¿ç”¨reactæŠ€æœ¯æ ˆçš„å°ä¼™ä¼´éƒ½ä¸å¯é¿å…çš„æ¥è§¦è¿‡<code class=\"language-text\">redux</code> + <code class=\"language-text\">react-redux</code>çš„è¿™å¥—ç»„åˆï¼Œä¼—æ‰€å‘¨çŸ¥reduxæ˜¯ä¸€ä¸ªéå¸¸ç²¾ç®€çš„åº“ï¼Œå®ƒå’Œreactæ˜¯æ²¡æœ‰åšä»»ä½•ç»“åˆçš„ï¼Œç”šè‡³å¯ä»¥åœ¨vueé¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p>\n<p> reduxçš„æ ¸å¿ƒçŠ¶æ€ç®¡ç†å®ç°å…¶å®å°±å‡ è¡Œä»£ç </p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">function</span> <span class=\"token function\">createStore</span><span class=\"token punctuation\">(</span>reducer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">let</span> currentState\n <span class=\"token keyword\">let</span> subscribers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n <span class=\"token keyword\">function</span> <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   currentState <span class=\"token operator\">=</span> <span class=\"token function\">reducer</span><span class=\"token punctuation\">(</span>currentState<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   subscribers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>s <span class=\"token operator\">=></span> <span class=\"token function\">s</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">}</span>\n\n <span class=\"token keyword\">function</span> <span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">return</span> currentState<span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n \n <span class=\"token keyword\">function</span> <span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>subscriber<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n     subscribers<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>subscriber<span class=\"token punctuation\">)</span>\n     <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token function\">unsubscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n         <span class=\"token operator\">...</span>\n     <span class=\"token punctuation\">}</span>\n <span class=\"token punctuation\">}</span>\n\n <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token keyword\">type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'INIT'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n   dispatch<span class=\"token punctuation\">,</span>\n   getState<span class=\"token punctuation\">,</span>\n <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p> å®ƒå°±æ˜¯åˆ©ç”¨é—­åŒ…ç®¡ç†äº†stateç­‰å˜é‡ï¼Œç„¶ååœ¨dispatchçš„æ—¶å€™é€šè¿‡ç”¨æˆ·å®šä¹‰reduceræ‹¿åˆ°æ–°çŠ¶æ€èµ‹å€¼ç»™stateï¼Œå†æŠŠå¤–éƒ¨é€šè¿‡subscribeçš„è®¢é˜…ç»™è§¦å‘ä¸€ä¸‹ã€‚  </p>\n<p> é‚£reduxçš„å®ç°ç®€å•äº†ï¼Œreact-reduxçš„å®ç°è‚¯å®šå°±éœ€è¦ç›¸å¯¹å¤æ‚ï¼Œå®ƒéœ€è¦è€ƒè™‘å¦‚ä½•å’Œreactçš„æ¸²æŸ“ç»“åˆèµ·æ¥ï¼Œå¦‚ä½•ä¼˜åŒ–æ€§èƒ½ã€‚ </p>\n<h2 id=\"ç›®æ ‡\"><a href=\"#%E7%9B%AE%E6%A0%87\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ç›®æ ‡</h2>\n<ol>\n<li>æœ¬æ–‡ç›®æ ‡æ˜¯å°½å¯èƒ½ç®€çŸ­çš„å®ç°<code class=\"language-text\">react-redux</code>v7ä¸­çš„hookç”¨æ³•éƒ¨åˆ†<code class=\"language-text\">Provider</code>, <code class=\"language-text\">useSelector</code>, <code class=\"language-text\">useDispatch</code>æ–¹æ³•ã€‚ï¼ˆä¸å®ç°<code class=\"language-text\">connect</code>æ–¹æ³•ï¼‰</li>\n<li>å¯èƒ½ä¼šå’Œå®˜æ–¹ç‰ˆæœ¬çš„ä¸€äº›å¤æ‚å®ç°ä¸ä¸€æ ·ï¼Œä½†æ˜¯ä¿è¯ä¸»è¦çš„æµç¨‹ä¸€è‡´ã€‚  </li>\n<li>ç”¨TypeScriptå®ç°ï¼Œå¹¶ä¸”èƒ½è·å¾—å®Œå–„çš„ç±»å‹æç¤ºã€‚</li>\n</ol>\n<h2 id=\"é¢„è§ˆ\"><a href=\"#%E9%A2%84%E8%A7%88\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>é¢„è§ˆ</h2>\n<p><img src=\"https://user-gold-cdn.xitu.io/2020/1/11/16f946f6c4fd8955?w=706&#x26;h=380&#x26;f=gif&#x26;s=188883\" alt=\"redux gif.gif\"><br>\né¢„è§ˆåœ°å€ï¼š<a href=\"https://sl1673495.github.io/tiny-react-redux\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://sl1673495.github.io/tiny-react-redux</a>  </p>\n<h2 id=\"æ€§èƒ½\"><a href=\"#%E6%80%A7%E8%83%BD\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>æ€§èƒ½</h2>\n<p> è¯´åˆ°æ€§èƒ½è¿™ä¸ªç‚¹ï¼Œè‡ªä»React Hookæ¨å‡ºä»¥åï¼Œæœ‰äº†<code class=\"language-text\">useContext</code>å’Œ<code class=\"language-text\">useReducer</code>è¿™äº›æ–¹ä¾¿çš„apiï¼Œæ–°çš„çŠ¶æ€ç®¡ç†åº“å¦‚åŒé›¨åæ˜¥ç¬‹ç‰ˆçš„å†’äº†å‡ºæ¥ï¼Œå…¶ä¸­çš„å¾ˆå¤šå°±æ˜¯åˆ©ç”¨äº†<code class=\"language-text\">Context</code>åšçŠ¶æ€çš„å‘ä¸‹ä¼ é€’ã€‚  </p>\n<p> ä¸¾ä¸€ä¸ªæœ€ç®€å•çš„çŠ¶æ€ç®¡ç†çš„ä¾‹å­</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> StoreContext <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>state<span class=\"token punctuation\">,</span> setState<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>StoreContext<span class=\"token punctuation\">.</span>Provider value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> state<span class=\"token punctuation\">,</span> setState <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>StoreContext<span class=\"token punctuation\">.</span>Provider<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Son</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> state <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>StoreContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>stateæ˜¯<span class=\"token punctuation\">{</span>state<span class=\"token punctuation\">.</span>xxx<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>åˆ©ç”¨useStateæˆ–è€…useContextï¼Œå¯ä»¥å¾ˆè½»æ¾çš„åœ¨æ‰€æœ‰ç»„ä»¶ä¹‹é—´é€šè¿‡Contextå…±äº«çŠ¶æ€ã€‚ </p>\n<p>ä½†æ˜¯è¿™ç§æ¨¡å¼çš„ç¼ºç‚¹åœ¨äºContextä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½é—®é¢˜ï¼Œä¸‹é¢æ˜¯Reactå®˜æ–¹æ–‡æ¡£ä¸­çš„æè¿°ï¼š</p>\n<p><img src=\"https://user-gold-cdn.xitu.io/2020/1/11/16f9412b5f3f10b2?w=1576&#x26;h=528&#x26;f=png&#x26;s=282752\" alt=\"Contextæ€§èƒ½é—®é¢˜\">  </p>\n<p>æƒ³åƒè¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œåœ¨åˆšåˆšæ‰€æè¿°çš„ContextçŠ¶æ€ç®¡ç†æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬çš„å…¨å±€çŠ¶æ€ä¸­æœ‰<code class=\"language-text\">count</code>å’Œ<code class=\"language-text\">message</code>ä¸¤ä¸ªçŠ¶æ€åˆ†åˆ«ç»™é€šè¿‡<code class=\"language-text\">StoreContext.Provider</code>å‘ä¸‹ä¼ é€’  </p>\n<ol>\n<li><code class=\"language-text\">Counter</code>è®¡æ•°å™¨ç»„ä»¶ä½¿ç”¨äº†<code class=\"language-text\">count</code></li>\n<li><code class=\"language-text\">Chatroom</code>èŠå¤©å®¤ç»„ä»¶ä½¿ç”¨äº†<code class=\"language-text\">message</code></li>\n</ol>\n<p>è€Œåœ¨è®¡æ•°å™¨ç»„ä»¶é€šè¿‡Contextä¸­æ‹¿åˆ°çš„setStateè§¦å‘äº†<code class=\"language-text\">count</code>æ”¹å˜çš„æ—¶å€™ï¼Œ  </p>\n<p>ç”±äºèŠå¤©å®¤ç»„ä»¶ä¹Ÿåˆ©ç”¨<code class=\"language-text\">useContext</code>æ¶ˆè´¹äº†ç”¨äºçŠ¶æ€ç®¡ç†çš„StoreContextï¼Œæ‰€ä»¥èŠå¤©å®¤ç»„ä»¶ä¹Ÿä¼šè¢«å¼ºåˆ¶é‡æ–°æ¸²æŸ“ï¼Œè¿™å°±é€ æˆäº†æ€§èƒ½æµªè´¹ã€‚  </p>\n<p>è™½ç„¶è¿™ç§æƒ…å†µå¯ä»¥ç”¨<code class=\"language-text\">useMemo</code>è¿›è¡Œä¼˜åŒ–ï¼Œä½†æ˜¯æ‰‹åŠ¨ä¼˜åŒ–å’Œç®¡ç†ä¾èµ–å¿…ç„¶ä¼šå¸¦æ¥ä¸€å®šç¨‹åº¦çš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œè€Œåœ¨ä¸æ‰‹åŠ¨ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œè‚¯å®šæ— æ³•è¾¾åˆ°ä¸Šé¢åŠ¨å›¾ä¸­çš„é‡æ¸²æŸ“ä¼˜åŒ–ã€‚  </p>\n<p>é‚£ä¹ˆ<code class=\"language-text\">react-redux</code>ä½œä¸ºç¤¾åŒºçŸ¥åçš„çŠ¶æ€ç®¡ç†åº“ï¼Œè‚¯å®šè¢«å¾ˆå¤šå¤§å‹é¡¹ç›®æ‰€ä½¿ç”¨ï¼Œå¤§å‹é¡¹ç›®é‡Œçš„çŠ¶æ€å¯èƒ½åˆ†æ•£åœ¨å„ä¸ªæ¨¡å—ä¸‹ï¼Œå®ƒæ˜¯æ€ä¹ˆè§£å†³ä¸Šè¿°çš„æ€§èƒ½ç¼ºé™·çš„å‘¢ï¼Ÿæ¥ç€å¾€ä¸‹çœ‹å§ã€‚  </p>\n<h2 id=\"ç¼ºé™·ç¤ºä¾‹\"><a href=\"#%E7%BC%BA%E9%99%B7%E7%A4%BA%E4%BE%8B\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ç¼ºé™·ç¤ºä¾‹</h2>\n<p>åœ¨æˆ‘ä¹‹å‰å†™çš„ç±»vuexè¯­æ³•çš„çŠ¶æ€ç®¡ç†åº“<a href=\"https://github.com/sl1673495/react-vuex-hook\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">react-vuex-hook</a>ä¸­ï¼Œå°±ä¼šæœ‰è¿™æ ·çš„é—®é¢˜ã€‚å› ä¸ºå®ƒå°±æ˜¯ç”¨äº†<code class=\"language-text\">Context</code> + <code class=\"language-text\">useReducer</code>çš„æ¨¡å¼ã€‚  </p>\n<p>ä½ å¯ä»¥ç›´æ¥åœ¨ <a href=\"https://sl1673495.github.io/react-vuex-hook\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">åœ¨çº¿ç¤ºä¾‹</a> è¿™é‡Œï¼Œåœ¨å·¦ä¾§èœå•æ é€‰æ‹©<code class=\"language-text\">éœ€è¦ä¼˜åŒ–çš„åœºæ™¯</code>ï¼Œå³å¯çœ‹åˆ°ä¸Šè¿°æ€§èƒ½é—®é¢˜çš„é‡ç°ï¼Œä¼˜åŒ–æ–¹æ¡ˆä¹Ÿå·²ç»å†™åœ¨æ–‡æ¡£åº•éƒ¨ã€‚  </p>\n<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘è§‰å¾—<code class=\"language-text\">Context</code> + <code class=\"language-text\">useReducer</code>çš„æ¨¡å¼æ›´é€‚åˆåœ¨å°å‹æ¨¡å—ä¹‹é—´å…±äº«çŠ¶æ€ï¼Œè€Œä¸æ˜¯åœ¨å…¨å±€ã€‚   </p>\n<h2 id=\"å®ç°\"><a href=\"#%E5%AE%9E%E7%8E%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>å®ç°</h2>\n<h3 id=\"ä»‹ç»\"><a href=\"#%E4%BB%8B%E7%BB%8D\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ä»‹ç»</h3>\n<p>æœ¬æ–‡çš„é¡¹ç›®å°±ä¸Šè¿°æ€§èƒ½åœºæ™¯æç‚¼è€Œæˆï¼Œç”±</p>\n<ol>\n<li><code class=\"language-text\">èŠå¤©å®¤</code>ç»„ä»¶ï¼Œç”¨äº†storeä¸­çš„<code class=\"language-text\">count</code></li>\n<li><code class=\"language-text\">è®¡æ•°å™¨</code>ç»„ä»¶ï¼Œç”¨äº†storeä¸­çš„<code class=\"language-text\">message</code></li>\n<li><code class=\"language-text\">æ§åˆ¶å°</code>ç»„ä»¶ï¼Œç”¨æ¥ç›‘æ§ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚  </li>\n</ol>\n<p>ç”¨æœ€ç®€çŸ­çš„æ–¹å¼å®ç°ä»£ç ï¼Œæ¢ç©¶react-reduxä¸ºä»€ä¹ˆèƒ½åœ¨<code class=\"language-text\">count</code>å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ä¸è®©ä½¿ç”¨äº†<code class=\"language-text\">message</code>çš„ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚  </p>\n<h3 id=\"reduxçš„å®šä¹‰\"><a href=\"#redux%E7%9A%84%E5%AE%9A%E4%B9%89\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>reduxçš„å®šä¹‰</h3>\n<p>reduxçš„ä½¿ç”¨å¾ˆä¼ ç»Ÿï¼Œè·Ÿç€å®˜æ–¹æ–‡æ¡£å¯¹äºTypeScriptçš„æŒ‡å¯¼èµ°èµ·æ¥ï¼Œå¹¶ä¸”æŠŠç±»å‹å®šä¹‰å’Œstoreéƒ½exportå‡ºå»ã€‚  </p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createStore <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux'</span><span class=\"token punctuation\">;</span>\n\ntype AddAction <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> <span class=\"token string\">'add'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\ntype ChatAction <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> <span class=\"token string\">'chat'</span><span class=\"token punctuation\">;</span>\n  payload<span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\ntype LogAction <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  type<span class=\"token punctuation\">:</span> <span class=\"token string\">'log'</span><span class=\"token punctuation\">;</span>\n  payload<span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> initState <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  message<span class=\"token punctuation\">:</span> <span class=\"token string\">'Hello'</span><span class=\"token punctuation\">,</span>\n  logs<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> string<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> type ActionType <span class=\"token operator\">=</span> AddAction <span class=\"token operator\">|</span> ChatAction <span class=\"token operator\">|</span> LogAction<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> type State <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> initState<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">reducer</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">:</span> State<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">:</span> ActionType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> State <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'add'</span><span class=\"token punctuation\">:</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n        count<span class=\"token punctuation\">:</span> state<span class=\"token punctuation\">.</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'chat'</span><span class=\"token punctuation\">:</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n        message<span class=\"token punctuation\">:</span> action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">case</span> <span class=\"token string\">'log'</span><span class=\"token punctuation\">:</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n        logs<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>state<span class=\"token punctuation\">.</span>logs<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span>\n      <span class=\"token keyword\">return</span> initState<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> store <span class=\"token operator\">=</span> <span class=\"token function\">createStore</span><span class=\"token punctuation\">(</span>reducer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"åœ¨é¡¹ç›®ä¸­ä½¿ç”¨\"><a href=\"#%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨</h3>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useState<span class=\"token punctuation\">,</span> useCallback <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Card<span class=\"token punctuation\">,</span> Button<span class=\"token punctuation\">,</span> Input <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'antd'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Provider<span class=\"token punctuation\">,</span> useSelector<span class=\"token punctuation\">,</span> useDispatch <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../src'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> store<span class=\"token punctuation\">,</span> State<span class=\"token punctuation\">,</span> ActionType <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./store'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'./index.css'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'antd/dist/antd.css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> count <span class=\"token operator\">=</span> <span class=\"token function\">useSelector</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">:</span> State<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> state<span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> dispatch <span class=\"token operator\">=</span> useDispatch<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ActionType</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">();\n  // åŒæ­¥çš„add\n  const add = useCallback(() => dispatch(</span><span class=\"token punctuation\">{</span> type<span class=\"token punctuation\">:</span> <span class=\"token string\">'add'</span> <span class=\"token punctuation\">}</span><span class=\"token plain-text\">), []);\n\n  dispatch(</span><span class=\"token punctuation\">{</span>\n    type<span class=\"token punctuation\">:</span> <span class=\"token string\">'log'</span><span class=\"token punctuation\">,</span>\n    payload<span class=\"token punctuation\">:</span> <span class=\"token string\">'è®¡æ•°å™¨ç»„ä»¶é‡æ–°æ¸²æŸ“ğŸš€'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token plain-text\">);\n  return (\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Card</span> <span class=\"token attr-name\">hoverable</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> marginBottom<span class=\"token punctuation\">:</span> <span class=\"token number\">24</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">è®¡æ•°å™¨</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>chunk<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>chunk<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">storeä¸­çš„countç°åœ¨æ˜¯ </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>add<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">add</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Card</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  );\n}\n\nexport default () => </span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Provider</span> <span class=\"token attr-name\">store</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>store<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Count</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Provider</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token plain-text\">;</span></code></pre></div>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç”¨<code class=\"language-text\">Provider</code>ç»„ä»¶é‡ŒåŒ…è£¹äº†<code class=\"language-text\">Count</code>ç»„ä»¶ï¼Œå¹¶ä¸”æŠŠreduxçš„storeä¼ é€’äº†ä¸‹å»  </p>\n<p>åœ¨å­ç»„ä»¶é‡Œï¼Œé€šè¿‡<code class=\"language-text\">useDispatch</code>å¯ä»¥æ‹¿åˆ°reduxçš„dispatchï¼Œ é€šè¿‡<code class=\"language-text\">useSelector</code>å¯ä»¥è®¿é—®åˆ°storeï¼Œæ‹¿åˆ°å…¶ä¸­ä»»æ„çš„è¿”å›å€¼ã€‚  </p>\n<h3 id=\"æ„å»ºcontext\"><a href=\"#%E6%9E%84%E5%BB%BAcontext\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>æ„å»ºContext</h3>\n<p>åˆ©ç”¨å®˜æ–¹apiæ„å»ºcontextï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªè‡ªå®šä¹‰hook: <code class=\"language-text\">useReduxContext</code>å»è®¿é—®è¿™ä¸ªcontextï¼Œå¯¹äºå¿˜äº†ç”¨ProvideråŒ…è£¹çš„æƒ…å†µè¿›è¡Œä¸€äº›é”™è¯¯æç¤ºï¼š  </p>\n<p>å¯¹äºä¸ç†Ÿæ‚‰è‡ªå®šä¹‰hookçš„å°ä¼™ä¼´ï¼Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰å†™çš„è¿™ç¯‡æ–‡ç« ï¼š<br>\n<a href=\"https://juejin.im/post/5d6771375188257573636cf9\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ä½¿ç”¨React Hooks + è‡ªå®šä¹‰Hookå°è£…ä¸€æ­¥ä¸€æ­¥æ‰“é€ ä¸€ä¸ªå®Œå–„çš„å°å‹åº”ç”¨ã€‚</a></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useContext <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Store <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">ContextType</span> <span class=\"token punctuation\">{</span>\n  store<span class=\"token punctuation\">:</span> Store<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> Context <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span>createContext<span class=\"token operator\">&lt;</span>ContextType <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">useReduxContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> contextValue <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>Context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>contextValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">'could not find react-redux context value; please ensure the component is wrapped in a &lt;Provider>'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> contextValue<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"å®ç°provider\"><a href=\"#%E5%AE%9E%E7%8E%B0provider\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>å®ç°Provider</h3>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">FC</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Store <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Context <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./Context'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">ProviderProps</span> <span class=\"token punctuation\">{</span>\n  store<span class=\"token punctuation\">:</span> Store<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> Provider<span class=\"token punctuation\">:</span> <span class=\"token constant\">FC</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ProviderProps</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"> = (</span><span class=\"token punctuation\">{</span> store<span class=\"token punctuation\">,</span> children <span class=\"token punctuation\">}</span><span class=\"token plain-text\">) => </span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Context.Provider</span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> store <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Context.Provider</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token plain-text\">;</span></code></pre></div>\n<h3 id=\"å®ç°usedispatch\"><a href=\"#%E5%AE%9E%E7%8E%B0usedispatch\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>å®ç°useDispatch</h3>\n<p>è¿™é‡Œå°±æ˜¯ç®€å•çš„æŠŠdispatchè¿”å›å‡ºå»ï¼Œé€šè¿‡æ³›å‹ä¼ é€’è®©å¤–éƒ¨ä½¿ç”¨çš„æ—¶å€™å¯ä»¥è·å¾—ç±»å‹æç¤ºã€‚  </p>\n<p>æ³›å‹æ¨å¯¼ä¸ç†Ÿæ‚‰çš„å°ä¼™ä¼´å¯ä»¥çœ‹ä¸€ä¸‹ä¹‹å‰è¿™ç¯‡ï¼š<br>\n<a href=\"https://juejin.im/post/5e1684b65188253a8c26468b\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">è¿›é˜¶å®ç°æ™ºèƒ½ç±»å‹æ¨å¯¼çš„ç®€åŒ–ç‰ˆVuex</a></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useReduxContext <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./Context'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Dispatch<span class=\"token punctuation\">,</span> Action <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> useDispatch<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>A</span> <span class=\"token attr-name\">extends</span> <span class=\"token attr-name\">Action</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">() </span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> store <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useReduxContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> store<span class=\"token punctuation\">.</span>dispatch <span class=\"token keyword\">as</span> Dispatch<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>A</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">;\n}</span></code></pre></div>\n<h3 id=\"å®ç°useselector\"><a href=\"#%E5%AE%9E%E7%8E%B0useselector\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>å®ç°useSelector</h3>\n<p>è¿™é‡Œæ‰æ˜¯é‡ç‚¹ï¼Œè¿™ä¸ªapiæœ‰ä¸¤ä¸ªå‚æ•°ã€‚</p>\n<ol>\n<li><code class=\"language-text\">selector</code>: å®šä¹‰å¦‚ä½•ä»stateä¸­å–å€¼ï¼Œå¦‚<code class=\"language-text\">state =&gt; state.count</code></li>\n<li><code class=\"language-text\">equalityFn</code>: å®šä¹‰å¦‚ä½•åˆ¤æ–­æ¸²æŸ“ä¹‹é—´å€¼æ˜¯å¦æœ‰æ”¹å˜ã€‚  </li>\n</ol>\n<p>åœ¨æ€§èƒ½ç« èŠ‚ä¹Ÿæåˆ°è¿‡ï¼Œå¤§å‹åº”ç”¨ä¸­å¿…é¡»åšåˆ°åªæœ‰è‡ªå·±ä½¿ç”¨çš„çŠ¶æ€æ”¹å˜äº†ï¼Œæ‰å»é‡æ–°æ¸²æŸ“ï¼Œé‚£ä¹ˆ<code class=\"language-text\">equalityFn</code>å°±æ˜¯åˆ¤æ–­æ˜¯å¦æ¸²æŸ“çš„å…³é”®äº†ã€‚  </p>\n<p>å…³é”®æµç¨‹ï¼ˆåˆå§‹åŒ–ï¼‰ï¼š  </p>\n<ol>\n<li>æ ¹æ®ä¼ å…¥çš„selectorä»reduxçš„storeä¸­å–å€¼ã€‚</li>\n<li>å®šä¹‰ä¸€ä¸ª<code class=\"language-text\">latestSelectedState</code>ä¿å­˜ä¸Šä¸€æ¬¡selectorè¿”å›çš„å€¼ã€‚</li>\n<li>å®šä¹‰ä¸€ä¸ª<code class=\"language-text\">checkForceUpdate</code>æ–¹æ³•ç”¨æ¥æ§åˆ¶å½“çŠ¶æ€å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œè®©å½“å‰ç»„ä»¶çš„å¼ºåˆ¶æ¸²æŸ“ã€‚</li>\n<li>åˆ©ç”¨<code class=\"language-text\">store.subscribe</code>è®¢é˜…ä¸€æ¬¡reduxçš„storeï¼Œä¸‹æ¬¡reduxçš„storeå‘ç”Ÿå˜åŒ–æ‰§è¡Œ<code class=\"language-text\">checkForceUpdate</code>ã€‚</li>\n</ol>\n<p>å…³é”®æµç¨‹ï¼ˆæ›´æ–°ï¼‰  </p>\n<ol>\n<li>å½“ç”¨æˆ·ä½¿ç”¨<code class=\"language-text\">dispatch</code>è§¦å‘äº†redux storeçš„å˜åŠ¨åï¼Œstoreä¼šè§¦å‘<code class=\"language-text\">checkForceUpdate</code>æ–¹æ³•ã€‚  </li>\n<li><code class=\"language-text\">checkForceUpdate</code>ä¸­ï¼Œä»<code class=\"language-text\">latestSelectedState</code>æ‹¿åˆ°ä¸Šä¸€æ¬¡selectorçš„è¿”å›å€¼ï¼Œå†åˆ©ç”¨selector(store)æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Œä¸¤è€…åˆ©ç”¨<code class=\"language-text\">equalityFn</code>è¿›è¡Œæ¯”è¾ƒã€‚</li>\n<li>æ ¹æ®æ¯”è¾ƒï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦å¼ºåˆ¶æ¸²æŸ“ç»„ä»¶ã€‚  </li>\n</ol>\n<p>æœ‰äº†è¿™ä¸ªæ€è·¯ï¼Œå°±æ¥å®ç°ä»£ç å§ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useReducer<span class=\"token punctuation\">,</span> useRef<span class=\"token punctuation\">,</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useReduxContext <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./Context'</span><span class=\"token punctuation\">;</span>\n\ntype Selector<span class=\"token operator\">&lt;</span>State<span class=\"token punctuation\">,</span> Selected<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">:</span> State<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Selected<span class=\"token punctuation\">;</span>\ntype EqualityFn<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Selected</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"> = (a: Selected, b: Selected) => boolean;\n\n// é»˜è®¤æ¯”è¾ƒçš„æ–¹æ³•\nconst defaultEqualityFn = </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>T</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">(a: T, b: T) => a === b;\nexport function useSelector&lt;State, Selected>(\n  selector: Selector&lt;State, Selected>,\n  equalityFn: EqualityFn</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Selected</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"> = defaultEqualityFn,\n) </span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> store <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useReduxContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// å¼ºåˆ¶è®©å½“å‰ç»„ä»¶æ¸²æŸ“çš„æ–¹æ³•ã€‚</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> forceRender<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useReducer</span><span class=\"token punctuation\">(</span>s <span class=\"token operator\">=></span> s <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// å­˜å‚¨ä¸Šä¸€æ¬¡selectorçš„è¿”å›å€¼ã€‚</span>\n  <span class=\"token keyword\">const</span> latestSelectedState <span class=\"token operator\">=</span> useRef<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Selected</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">();\n  // æ ¹æ®ç”¨æˆ·ä¼ å…¥çš„selectorï¼Œä»storeä¸­æ‹¿åˆ°ç”¨æˆ·æƒ³è¦çš„å€¼ã€‚\n  const selectedState = selector(store.getState());\n\n  // æ£€æŸ¥æ˜¯å¦éœ€è¦å¼ºåˆ¶æ›´æ–°\n  function checkForUpdates() </span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ä»storeä¸­æ‹¿åˆ°æœ€æ–°çš„å€¼</span>\n    <span class=\"token keyword\">const</span> newSelectedState <span class=\"token operator\">=</span> <span class=\"token function\">selector</span><span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// å¦‚æœæ¯”è¾ƒç›¸ç­‰ï¼Œå°±å•¥ä¹Ÿä¸åš</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">equalityFn</span><span class=\"token punctuation\">(</span>newSelectedState<span class=\"token punctuation\">,</span> latestSelectedState<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// å¦åˆ™æ›´æ–°refä¸­ä¿å­˜çš„ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å€¼</span>\n    <span class=\"token comment\">// ç„¶åå¼ºåˆ¶æ¸²æŸ“</span>\n    latestSelectedState<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> newSelectedState<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">forceRender</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n  \n  // ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“å æ‰§è¡Œè®¢é˜…storeçš„é€»è¾‘\n  useEffect(() => </span><span class=\"token punctuation\">{</span>\n  \n    <span class=\"token comment\">// ğŸš€é‡ç‚¹ï¼Œå»è®¢é˜…redux storeçš„å˜åŒ–</span>\n    <span class=\"token comment\">// åœ¨ç”¨æˆ·è°ƒç”¨äº†dispatchåï¼Œæ‰§è¡ŒcheckForUpdates</span>\n    <span class=\"token keyword\">const</span> unsubscribe <span class=\"token operator\">=</span> store<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>checkForUpdates<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">// ç»„ä»¶è¢«é”€æ¯å éœ€è¦è°ƒç”¨unsubscribeåœæ­¢è®¢é˜…</span>\n    <span class=\"token keyword\">return</span> unsubscribe<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token plain-text\">, []);\n  \n  return selectedState;\n}</span></code></pre></div>\n<h2 id=\"æ€»ç»“\"><a href=\"#%E6%80%BB%E7%BB%93\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>æ€»ç»“</h2>\n<p>æœ¬æ–‡æ¶‰åŠåˆ°çš„æºç åœ°å€ï¼š<br>\n<a href=\"https://github.com/sl1673495/tiny-react-redux\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/sl1673495/tiny-react-redux</a>  </p>\n<p>åŸç‰ˆçš„react-reduxçš„å®ç°è‚¯å®šæ¯”è¿™é‡Œçš„ç®€åŒ–ç‰ˆè¦å¤æ‚çš„å¤šï¼Œå®ƒè¦è€ƒè™‘classç»„ä»¶çš„ä½¿ç”¨ï¼Œä»¥åŠæ›´å¤šçš„ä¼˜åŒ–ä»¥åŠè¾¹ç•Œæƒ…å†µã€‚  </p>\n<p>ä»ç®€åŒ–ç‰ˆçš„å®ç°å…¥æ‰‹ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ¸…æ™°çš„å¾—åˆ°æ•´ä¸ªæµç¨‹è„‰ç»œï¼Œå¦‚æœä½ æƒ³è¿›ä¸€æ­¥çš„å­¦ä¹ æºç ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘å¤šèŠ±ç‚¹æ—¶é—´å»çœ‹å®˜æ–¹æºç å¹¶ä¸”å•æ­¥è°ƒè¯•ã€‚  </p>","timeToRead":9,"frontmatter":{"title":"React-Redux 100è¡Œä»£ç ç®€æ˜“ç‰ˆæ¢ç©¶åŸç†","date":"January 14, 2020","spoiler":""},"fields":{"slug":"/549412665/","langKey":"en"}}},"pageContext":{"slug":"/549412665/","previous":{"fields":{"slug":"/546349944/","langKey":"en","directoryName":"546349944"},"frontmatter":{"title":"Koaçš„æ´‹è‘±ä¸­é—´ä»¶ï¼ŒReduxçš„ä¸­é—´ä»¶ï¼ŒAxiosçš„æ‹¦æˆªå™¨è®©ä½ è¿·æƒ‘å—ï¼Ÿå®ç°ä¸€ä¸ªç²¾ç®€ç‰ˆçš„å°±å½»åº•ææ‡‚äº†ã€‚"}},"next":{"fields":{"slug":"/549412377/","langKey":"en","directoryName":"549412377"},"frontmatter":{"title":"TypeScriptè¿›é˜¶å®ç°æ™ºèƒ½ç±»å‹æ¨å¯¼çš„ç®€åŒ–ç‰ˆVuex"}},"translations":[],"translatedLinks":[]}},"staticQueryHashes":["336482444"]}